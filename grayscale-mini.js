L.TileLayer.Grayscale=L.TileLayer.extend({options:{quotaRed:21,quotaGreen:71,quotaBlue:8,quotaDividerTune:0,quotaDivider:function(){return this.quotaRed+this.quotaGreen+this.quotaBlue+this.quotaDividerTune}},initialize:function(t,e){(e=e||{}).crossOrigin=!0,L.TileLayer.prototype.initialize.call(this,t,e),this.on("tileload",function(t){this._makeGrayscale(t.tile)})},_createTile:function(){var t=L.TileLayer.prototype._createTile.call(this);return t.crossOrigin="Anonymous",t},_makeGrayscale:function(t){if(!t.getAttribute("data-grayscaled")){t.crossOrigin="";var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var a=e.getContext("2d");a.drawImage(t,0,0);for(var i=a.getImageData(0,0,e.width,e.height),r=i.data,o=0,n=r.length;o<n;o+=4)r[o]=r[o+1]=r[o+2]=(this.options.quotaRed*r[o]+this.options.quotaGreen*r[o+1]+this.options.quotaBlue*r[o+2])/this.options.quotaDivider();a.putImageData(i,0,0),t.setAttribute("data-grayscaled",!0),t.src=e.toDataURL()}}}),L.tileLayer.grayscale=function(t,e){return new L.TileLayer.Grayscale(t,e)};